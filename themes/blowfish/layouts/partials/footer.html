<footer id="site-footer" class="py-10 print:hidden">
  {{/* Footer menu */}}
  {{ if .Site.Params.footer.showMenu | default true }}
    {{ if .Site.Menus.footer }}
      {{ $onlyIcon := true }}
      {{ range .Site.Menus.footer }}
        {{ if .Name }}
          {{ $onlyIcon = false }}
          {{ break }}
        {{ end }}
      {{ end }}
      {{ $navClass := printf "flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 %s" (cond $onlyIcon "overflow-x-auto py-2" "") }}
      {{ $ulClass := printf "flex list-none %s" (cond $onlyIcon "flex-row" "flex-col sm:flex-row") }}
      {{ $liClass := printf "flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 %s" (cond $onlyIcon "me-4" "") }}
      <nav class="{{ $navClass }}">
        <ul class="{{ $ulClass }}">
          {{ range .Site.Menus.footer }}
            <li class=" {{ $liClass }}">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href="{{ .URL }}"
                title="{{ .Title }}">
                {{ if .Pre }}
                  <span {{ if and .Pre .Name }}class="mr-1"{{ end }}>
                    {{ partial "icon.html" .Pre }}
                  </span>
                {{ end }}
                {{ .Name | markdownify }}
              </a>
            </li>
          {{ end }}
        </ul>
      </nav>
    {{ end }}
  {{ end }}
  <div class="flex items-center justify-between">
    {{/* Copyright */}}
    {{ if .Site.Params.footer.showCopyright | default true }}
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
        {{- with replace .Site.Params.copyright "{ year }" now.Year }}
          {{ . | markdownify }}
        {{- else }}
          &copy;
          {{ now.Format "2006" }}
          {{ .Site.Params.Author.name | markdownify }}
        {{- end }}
      </p>
    {{ end }}

    {{/* Theme attribution */}}
    {{ if .Site.Params.footer.showThemeAttribution | default true }}
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        {{ $hugo := printf `<a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>`
        }}
        {{ $blowfish := printf `<a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>`
        }}
        {{ i18n "footer.powered_by" (dict "Hugo" $hugo "Theme" $blowfish) | safeHTML }}
      </p>
    {{ end }}
  </div>
  {{ if not .Site.Params.disableImageZoom | default true }}
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  {{ end }}
  {{ $jsProcess := resources.Get "js/process.js" }}
  {{ $jsProcess = $jsProcess | resources.Minify | resources.Fingerprint (.Site.Params.fingerprintAlgorithm | default "sha512") }}
  <script
    type="text/javascript"
    src="{{ $jsProcess.RelPermalink }}"
    integrity="{{ $jsProcess.Data.Integrity }}"></script>
  {{/* Extend footer - eg. for extra scripts, etc. */}}
  {{ if templates.Exists "partials/extend-footer.html" }}
    {{ partialCached "extend-footer.html" . }}
  {{ end }}

<!-- 布局容器 -->
<div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; width: 100%; gap: 20px;">
  
  <!-- 左侧：地球仪 (Globe) - 这里的样式控制 iframe 的大小 -->
  <div style="flex: 1; min-width: 250px; height: 200px; display: flex; justify-content: center; align-items: center; border: 1px solid #eee; border-radius: 8px; overflow: hidden;">
    <!-- 我们只放一个空的容器，稍后用 JS 往里面塞 iframe -->
    <div id="sandbox-globe" style="width: 100%; height: 100%;"></div>
  </div>

  <!-- 右侧：平面地图 (Map) -->
  <div style="flex: 2; min-width: 250px; height: 200px; display: flex; justify-content: center; align-items: center; border: 1px solid #eee; border-radius: 8px; overflow: hidden;">
    <div id="sandbox-map" style="width: 100%; height: 100%;"></div>
  </div>

</div>

<div class="map-wrapper">
    <h3>访客地球仪</h3>
    <div id="sandbox-globe"></div>
</div>

<div class="map-wrapper">
    <h3>访客地图</h3>
    <div id="sandbox-map"></div>
</div>

<style>
    /* 确保容器有高度，否则 iframe 不显示 */
    #sandbox-globe, #sandbox-map {
        width: 100%;
        height: 400px; /* 根据需要调整 */
        border: 1px solid #eee; /* 可选：加个边框方便调试看到区域 */
        background-color: #f9f9f9; /* 可选：加载前的背景色 */
    }
</style>

<script>
  window.addEventListener('DOMContentLoaded', function() {
    
    // 定义创建沙箱的函数
    function createSandbox(containerId, scriptSrc, scriptId) {
      const container = document.getElementById(containerId);
      if (!container) {
        console.error('容器未找到:', containerId);
        return;
      }

      // 1. 清空容器
      container.innerHTML = "";

      // 2. 创建 iframe
      const iframe = document.createElement('iframe');
      iframe.id = `${containerId}-iframe`;
      iframe.style.width = "100%";
      iframe.style.height = "100%";
      iframe.style.border = "none";
      iframe.style.overflow = "hidden";
      iframe.style.display = "block"; // 确保显示
      iframe.setAttribute("scrolling", "no");
      
      // 3. 添加加载错误处理
      iframe.onload = function() {
        console.log(`${containerId} iframe 加载完成`);
      };
      
      iframe.onerror = function() {
        console.error(`${containerId} iframe 加载失败`);
      };

      // 4. 将 iframe 放入容器
      container.appendChild(iframe);

      // 5. 等待 iframe 就绪
      setTimeout(() => {
        try {
          const doc = iframe.contentDocument || iframe.contentWindow.document;
          
          doc.open();
          doc.write(`
            <!DOCTYPE html>
            <html style="overflow:hidden; margin:0; padding:0; height:100%;">
            <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
            </head>
            <body style="margin:0; padding:0; overflow:hidden; height:100%;">
              <div id="${scriptId}_container" 
                   style="width:100%; height:100%; min-height:400px;">
              </div>
              <script type="text/javascript" 
                      id="${scriptId}" 
                      src="${scriptSrc}"
                      async
                      defer><\/script>
            </body>
            </html>
          `);
          doc.close();
          
          console.log(`${containerId} 内容已写入`);
        } catch (error) {
          console.error(`${containerId} 写入失败:`, error);
        }
      }, 100);
    }

    // 延迟执行确保容器已渲染
    setTimeout(function() {
      console.log('开始加载地图插件...');
      
      // 加载地球仪
      createSandbox(
        'sandbox-globe', 
        'https://clustrmaps.com/globe.js?d=jifEa5wkGJle7rCzR78Wj3gsC9ebbUKEwiITXbd3qGA',
        'clustrmaps-globe'
      );

      // 加载平面地图
      createSandbox(
        'sandbox-map', 
        'https://clustrmaps.com/map_v2.js?d=jifEa5wkGJle7rCzR78Wj3gsC9ebbUKEwiITXbd3qGA&cl=ffffff&w=a',
        'clustrmaps-map'
      );
      
    }, 500);

  });
</script>
</footer>
