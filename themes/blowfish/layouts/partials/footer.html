<footer id="site-footer" class="py-10 print:hidden">
  {{/* Footer menu */}}
  {{ if .Site.Params.footer.showMenu | default true }}
    {{ if .Site.Menus.footer }}
      {{ $onlyIcon := true }}
      {{ range .Site.Menus.footer }}
        {{ if .Name }}
          {{ $onlyIcon = false }}
          {{ break }}
        {{ end }}
      {{ end }}
      {{ $navClass := printf "flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400 %s" (cond $onlyIcon "overflow-x-auto py-2" "") }}
      {{ $ulClass := printf "flex list-none %s" (cond $onlyIcon "flex-row" "flex-col sm:flex-row") }}
      {{ $liClass := printf "flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0 %s" (cond $onlyIcon "me-4" "") }}
      <nav class="{{ $navClass }}">
        <ul class="{{ $ulClass }}">
          {{ range .Site.Menus.footer }}
            <li class=" {{ $liClass }}">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center"
                href="{{ .URL }}"
                title="{{ .Title }}">
                {{ if .Pre }}
                  <span {{ if and .Pre .Name }}class="mr-1"{{ end }}>
                    {{ partial "icon.html" .Pre }}
                  </span>
                {{ end }}
                {{ .Name | markdownify }}
              </a>
            </li>
          {{ end }}
        </ul>
      </nav>
    {{ end }}
  {{ end }}
  <div class="flex items-center justify-between">
    {{/* Copyright */}}
    {{ if .Site.Params.footer.showCopyright | default true }}
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
        {{- with replace .Site.Params.copyright "{ year }" now.Year }}
          {{ . | markdownify }}
        {{- else }}
          &copy;
          {{ now.Format "2006" }}
          {{ .Site.Params.Author.name | markdownify }}
        {{- end }}
      </p>
    {{ end }}

    {{/* Theme attribution */}}
    {{ if .Site.Params.footer.showThemeAttribution | default true }}
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        {{ $hugo := printf `<a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>`
        }}
        {{ $blowfish := printf `<a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>`
        }}
        {{ i18n "footer.powered_by" (dict "Hugo" $hugo "Theme" $blowfish) | safeHTML }}
      </p>
    {{ end }}
  </div>
  {{ if not .Site.Params.disableImageZoom | default true }}
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  {{ end }}
  {{ $jsProcess := resources.Get "js/process.js" }}
  {{ $jsProcess = $jsProcess | resources.Minify | resources.Fingerprint (.Site.Params.fingerprintAlgorithm | default "sha512") }}
  <script
    type="text/javascript"
    src="{{ $jsProcess.RelPermalink }}"
    integrity="{{ $jsProcess.Data.Integrity }}"></script>
  {{/* Extend footer - eg. for extra scripts, etc. */}}
  {{ if templates.Exists "partials/extend-footer.html" }}
    {{ partialCached "extend-footer.html" . }}
  {{ end }}


<!-- 样式：强制约束 -->
<style>
  /* 外层容器：Flex布局 */
  .clustrmaps-wrapper {
    display: flex;
    flex-wrap: wrap; /* 允许小屏换行 */
    justify-content: space-between;
    align-items: center;
    width: 100%;
    gap: 20px;
  }

  /* 保护层：绝对限制大小，溢出隐藏 */
  .plugin-box {
    flex: 1;
    min-width: 250px; /* 最小宽度，防止太窄 */
    height: 200px;    /* 固定高度，防止塌陷 */
    overflow: hidden; /* 核心：砍掉溢出的部分 */
    position: relative;
    border: 1px solid #eee; /* 可选：加个边框方便调试看到范围 */
    border-radius: 8px;
  }
  
  /* 针对地球仪的特殊限制：防止它在计算时撑大flex父级 */
  #globe-box {
    max-width: 300px; /* 限制地球仪最大宽度 */
  }

  /* 内部容器：占满保护层 */
  .clustrmaps-container {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
</style>

<div class="clustrmaps-wrapper">
  
  <!-- 地球仪 (Globe) -->
  <div class="plugin-box" id="globe-box">
    <div id="clustrmaps-globe-container" class="clustrmaps-container"></div>
  </div>

  <!-- 平面地图 (Map) -->
  <div class="plugin-box">
    <div id="clustrmaps-map-container" class="clustrmaps-container"></div>
  </div>

</div>

<script>
  window.addEventListener('load', function() {
    // 使用 setTimeout 延迟加载
    // 确保页面布局完全渲染完毕后，再插入脚本，防止读取错误的宽度
    setTimeout(function() {
      
      // 1. 加载 Globe
      const globeContainer = document.getElementById('clustrmaps-globe-container');
      if (globeContainer) {
        // 清理旧内容（防止刷新残留）
        globeContainer.innerHTML = ''; 
        const script1 = document.createElement('script');
        script1.type = 'text/javascript';
        script1.async = true; 
        script1.src = '//clustrmaps.com/globe.js?d=jifEa5wkGJle7rCzR78Wj3gsC9ebbUKEwiITXbd3qGA';
        script1.id = 'clustrmaps-globe-script-tag';
        globeContainer.appendChild(script1);
      }

      // 2. 加载 Map
      const mapContainer = document.getElementById('clustrmaps-map-container');
      if (mapContainer) {
        mapContainer.innerHTML = '';
        const script2 = document.createElement('script');
        script2.type = 'text/javascript';
        script2.async = true;
        // 注意：Map 脚本通常支持 &w=... 参数，这里保留原来的设置
        script2.src = '//clustrmaps.com/map_v2.js?d=jifEa5wkGJle7rCzR78Wj3gsC9ebbUKEwiITXbd3qGA&cl=ffffff&w=a';
        script2.id = 'clustrmaps-map-script-tag';
        mapContainer.appendChild(script2);
      }

    }, 500); // 延迟 500ms 执行，这个时间对用户几乎无感，但对布局稳定至关重要
  });
</script>


</footer>
